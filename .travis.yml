language: ruby
dist: xenial
cache:
  bundler: true
  yarn: true
services:
- postgresql
- redis
branches:
  only:
  - main
addons:
  postgresql: '10'
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
    - chromium-chromedriver
    - google-chrome-stable
    - redis-server
env:
  global:
  - RAILS_ENV=test
before_install:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64  >
  ./cc-test-reporter
- chmod +x ./cc-test-reporter
- export PATH=$PWD/geckodriver:$PATH
install:
- nvm install 10
- npm i -g yarn
- bundle install
- yarn install
before_script:
- cp example.env .env
- cp config/database.example.yml config/database.yml
- cp config/secrets.example.yml config/secrets.yml
- RAILS_ENV=test bundle exec rake db:create db:migrate
- bundle exec rails assets:precompile
script:
- bin/ci-run
after_script:
- "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT -t simplecov --id
  $CC_TEST_REPORTER_ID"
deploy:
  provider: heroku
  cleanup: false
  on:
    repo: croissant-mfe/croissant
  app:
    main: croissant-tagging
  run:
  - bundle install
  - yarn install
  - bundle exec rake tmp:cache:clear
  - bundle exec rake db:migrate
  - bundle exec rake assets:precompile
  - restart
  api_key:
    secure: BXHK13ob+pkGK5zrxLfahfJE3qVkuqSswSIUo9nVmWqADE/Mrp7BXeuO6N6uZLTmrt8mxUJYjGZipe8wCuSBIfp6m5ofXU4wAqJ2TQEehVkq3XxP7rGEYIzZqtyugdtz1wB9eDMLLZEy6cJNMNTtDPgJuIBpYGfVt6GuNGJxEkDivSAyAMDiEw6MLYVtQUloNZlsNWT1ynyQmnwxwG4GHqAeJ03/86n1bfTwtetvUmQRddz3hn+BDJjsKb8a8ETmqcjfZ8sFBzVi2ovbcydsvi5nNd9sRtn6jeblBp2zcYLlpGKLCEoSICGaXqvb+Cq0KSn/dVpk6k5YvQ4Pe2rpt4u2dYkSl0ux17cJkTWiwB2E0zPT52hboJkS0D79QxYc+KMxrnCFqZhov1vQKmrOPbXh/Q0+jYmiMuPinbQvIXkh5JUQnd+DwOhwwb+TkxfNawEeGw3iqjSGdrae0c75p1S25E+wSxvoD+TUFzLQh34mNIg6Pz8QeobGp9Fexw7FzJ8A2B0L+xhRng94+SwxXETVLI4Qll+NKMxr3+nPDMi+N/pHTupSLajrlmBHHhYmu7EEnFGqt4udeyr6hJ1EA4Um3hdzO8S4Z0ZQm3AyH9AVp0+y9kfJ/3dBg/tUYK0mnEYps/5f1JAC0KHy32/gECrefHwarQ018GwkEmdoN3A=
